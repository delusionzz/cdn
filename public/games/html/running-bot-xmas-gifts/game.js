var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.arrayIteratorImpl=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},$jscomp.arrayIterator=function(e){return{next:$jscomp.arrayIteratorImpl(e)}},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.SIMPLE_FROUND_POLYFILL=!1,$jscomp.ISOLATE_POLYFILLS=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,i){return e==Array.prototype||e==Object.prototype?e:(e[t]=i.value,e)},$jscomp.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var t=0;t<e.length;++t){var i=e[t];if(i&&i.Math==Math)return i}throw Error("Cannot find global object")},$jscomp.global=$jscomp.getGlobal(this),$jscomp.IS_SYMBOL_NATIVE="function"==typeof Symbol&&"symbol"==typeof Symbol("x"),$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE,$jscomp.polyfills={},$jscomp.propertyToPolyfillSymbol={},$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(e,t){var i=$jscomp.propertyToPolyfillSymbol[t];return null==i?e[t]:void 0!==(i=e[i])?i:e[t]};$jscomp.polyfill=function(e,t,i,o){t&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(e,t,i,o):$jscomp.polyfillUnisolated(e,t,i,o))},$jscomp.polyfillUnisolated=function(e,t,i,o){for(i=$jscomp.global,e=e.split("."),o=0;o<e.length-1;o++){var n=e[o];if(!(n in i))return;i=i[n]}(t=t(o=i[e=e[e.length-1]]))!=o&&null!=t&&$jscomp.defineProperty(i,e,{configurable:!0,writable:!0,value:t})},$jscomp.polyfillIsolated=function(e,t,i,o){var n=e.split(".");e=1===n.length,o=n[0],o=!e&&o in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var s=0;s<n.length-1;s++){var a=n[s];if(!(a in o))return;o=o[a]}n=n[n.length-1],null!=(t=t(i=$jscomp.IS_SYMBOL_NATIVE&&"es6"===i?o[n]:null))&&(e?$jscomp.defineProperty($jscomp.polyfills,n,{configurable:!0,writable:!0,value:t}):t!==i&&($jscomp.propertyToPolyfillSymbol[n]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(n):$jscomp.POLYFILL_PREFIX+n,n=$jscomp.propertyToPolyfillSymbol[n],$jscomp.defineProperty(o,n,{configurable:!0,writable:!0,value:t})))},$jscomp.initSymbol=function(){},$jscomp.polyfill("Symbol",function(e){if(e)return e;var t=function(e,t){this.$jscomp$symbol$id_=e,$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:t})};t.prototype.toString=function(){return this.$jscomp$symbol$id_};var i=0,o=function(e){if(this instanceof o)throw new TypeError("Symbol is not a constructor");return new t("jscomp_symbol_"+(e||"")+"_"+i++,e)};return o},"es6","es3"),$jscomp.initSymbolIterator=function(){},$jscomp.polyfill("Symbol.iterator",function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),i=0;i<t.length;i++){var o=$jscomp.global[t[i]];"function"==typeof o&&"function"!=typeof o.prototype[e]&&$jscomp.defineProperty(o.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return e},"es6","es3"),$jscomp.initSymbolAsyncIterator=function(){},$jscomp.iteratorPrototype=function(e){return(e={next:e})[Symbol.iterator]=function(){return this},e},$jscomp.iteratorFromArray=function(e,t){e instanceof String&&(e+="");var i=0,o={next:function(){if(i<e.length){var n=i++;return{value:t(n,e[n]),done:!1}}return o.next=function(){return{done:!0,value:void 0}},o.next()}};return o[Symbol.iterator]=function(){return o},o},$jscomp.polyfill("Array.prototype.keys",function(e){return e||function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6","es3"),$jscomp.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},$jscomp.polyfill("Object.values",function(e){return e||function(e){var t,i=[];for(t in e)$jscomp.owns(e,t)&&i.push(e[t]);return i}},"es8","es3"),$jscomp.polyfill("Array.prototype.entries",function(e){return e||function(){return $jscomp.iteratorFromArray(this,function(e,t){return[e,t]})}},"es6","es3"),$jscomp.findInternal=function(e,t,i){e instanceof String&&(e=String(e));for(var o=e.length,n=0;n<o;n++){var s=e[n];if(t.call(i,s,n,e))return{i:n,v:s}}return{i:-1,v:void 0}},$jscomp.polyfill("Array.prototype.find",function(e){return e||function(e,t){return $jscomp.findInternal(this,e,t).v}},"es6","es3"),$jscomp.checkStringArgs=function(e,t,i){if(null==e)throw new TypeError("The 'this' value for String.prototype."+i+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+i+" must not be a regular expression");return e+""},$jscomp.polyfill("String.prototype.repeat",function(e){return e||function(e){var t=$jscomp.checkStringArgs(this,null,"repeat");if(0>e||1342177279<e)throw new RangeError("Invalid count value");e|=0;for(var i="";e;)1&e&&(i+=t),(e>>>=1)&&(t+=t);return i}},"es6","es3"),$jscomp.polyfill("Object.is",function(e){return e||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},"es6","es3"),$jscomp.polyfill("Array.prototype.includes",function(e){return e||function(e,t){var i=this;i instanceof String&&(i=String(i));var o=i.length;for(0>(t=t||0)&&(t=Math.max(t+o,0));t<o;t++){var n=i[t];if(n===e||Object.is(n,e))return!0}return!1}},"es7","es3"),$jscomp.polyfill("String.prototype.includes",function(e){return e||function(e,t){return-1!==$jscomp.checkStringArgs(this,e,"includes").indexOf(e,t||0)}},"es6","es3");var _TEXT={us:{Level:"Level",Duration:"Duration",Lives:"Lives",Move:"Move",Jump:"Jump",Upgrade:"UPGRADE",Continue:"Continue",Powerups:"Powerups",Skins:"Skins",Distance:"Distance: ",YourBest:"Your best distance: ",NewBest:"New best distance!",ItemBought:"Item bought successfully!",NotEnough:"Not enough gifts!",TapToContinue:"Tap To Continue!",SpaceToContinue:"Press SPACEBAR To Continue!",SpaceToRestart:"Press SPACEBAR To Restart!",Loading:"Loading leaderboard data...",NoEntries:"No entries found! Be the first!",Leaderboard:"LEADERBOARD",Rank:"Rank",Username:"User Name",Score:"Distance",YourResult:"Your Result:",Join:"Join The Leaderboard?",Login:"Login Yandex Passport",Anonymous:"Anonymous"}},vgAds={gID:"UA-50806252-7",sdkUrl:"https://yandex.ru/games/sdk/v2",adCooldownTime:180,adCooldownTimeoutId:null,isSdkReady:!1,isAdShown:!1,isAdCoolingDown:!1,logStyle:"background: #f26c4f; color: yellow; font-size: 14px;",showLogs:!0,log:function(e){this.showLogs&&console.log("%c "+e+" ",this.logStyle)},loadSdk:function(){this.log("Load Ad SDK");var e=document.getElementsByTagName("script")[0];if(!document.getElementById("id-jssdk")){var t=document.createElement("script");t.id="id-jssdk",t.src=this.sdkUrl,e.parentNode.insertBefore(t,e),t.onload=this.onSdkReady.bind(this)}},initGA:function(){var e=this;!function(t,i,o){var n=t.getElementsByTagName(i)[0];if(!t.getElementById(o)){var s="https://www.googletagmanager.com/gtag/js?id="+e.gID,a=t.createElement(i);a.id=o,a.src=s,a.async=!0,a.onload=function(){function t(){dataLayer.push(arguments)}a.onload=null,window.dataLayer=window.dataLayer||[],t("js",new Date),t("config",e.gID)},n.parentNode.insertBefore(a,n)}}(document,"script","gtag")},onSdkReady:function(){this.log("Yandex SDK is loaded and ready"),this.isSdkReady=!0;var e=this;YaGames.init({adv:{onAdvClose:this.onAdHide.bind(this)}}).then(function(t){window.ysdk=t,e.showAd();try{vg.lb.init(),1!==vg.load("langDetected")&&(vg.save("langDetected",1),vg.language=t.environment.i18n.lang,"ru"!=vg.language&&(vg.language="us"),vg.setLanguage(vg.language),$("#btFullscreen").hide())}catch(e){}})},startAdCooldown:function(){this.isAdCoolingDown||(this.isAdCoolingDown=!0,this.adCooldownTimeoutId=window.setTimeout(this.stopAdCooldown.bind(this),1e3*this.adCooldownTime))},stopAdCooldown:function(){this.isAdCoolingDown&&(this.isAdCoolingDown=!1,window.clearTimeout(this.adCooldownTimeoutId))},showAd:function(){if(this.isSdkReady)if(this.isAdShown)this.log("Yandex API is already showing an ad");else if(this.isAdCoolingDown)this.log("Yandex API is cooling down.");else{this.startAdCooldown(),this.log("Show Ad");try{ysdk.adv.showFullscreenAdv({callbacks:{onOpen:function(){this.onAdShow()}.bind(this),onClose:function(e){e&&this.onAdHide()}.bind(this)}})}catch(e){}}else this.log("Yandex SDK is not ready")},onAdShow:function(){this.log("Yandex API is showing an ad"),this.isAdShown=!0,vg.pauseGame()},onAdHide:function(){this.log("Ad is hidden"),this.isAdShown=!1,vg.resumeGame(),window.focus()},showRVAd:function(e){this.isSdkReady&&ysdk.adv.showRewardedVideo({callbacks:{onOpen:function(){this.onAdShow()}.bind(this),onRewarded:function(){this.onAdHide(),"function"==typeof e&&e()}.bind(this),onClose:function(){this.onAdHide()}.bind(this),onError:function(e){this.onAdHide()}.bind(this)}})},isRVReady:function(){return!0}};vgAds.loadSdk(),vgAds.initGA(),console.log("Update: 07/01/2022 13:30:43");var vg=vg||{};vg.audio=vg.audio||{},vg.audioContextResumed=!1,vg.bgmMuted=0,vg.sfxMuted=0,vg.play=function(e){"bgm"!=e?!vg.sfxMuted&&(e=vg.audio[e])&&(e.isPlaying&&e.stop(),e.play()):vg.bgmMuted||(e=vg.audio[e])&&!e.isPlaying&&e.play()},vg.stop=function(e){(e=vg.audio[e])&&e.isPlaying&&e.stop()},vg.pause=function(e){(e=vg.audio[e])&&e.isPlaying&&e.pause()};var resumeAudioContext=function(e){if(e.preventDefault(),!vg.audioContextResumed||vg.ready){e=!0;try{vg.bgmMuted||vg.play("bgm")}catch(t){e=!1}e&&(document.removeEventListener("mouseup",resumeAudioContext),document.removeEventListener("touchend",resumeAudioContext),vg.audioContextResumed=!0)}};document.addEventListener("mouseup",resumeAudioContext,!1),document.addEventListener("touchend",resumeAudioContext,!1),vg.audioFadeIn=function(e,t){var i=vg.audio[e];if(void 0!==i){i.setVolume(0),i.play();var o={value:0};void 0===t&&(t=2),new TWEEN.Tween(o).to({value:1},t).onUpdate(function(){i.setVolume(o.value)}).start()}},vg.audioFadeOut=function(e,t){var i=vg.audio[e];if(void 0!==i){var o={value:i.getVolume()};void 0===t&&(t=2),new TWEEN.Tween(o).to({value:0},t).onUpdate(function(){i.setVolume(o.value)}).start()}},vg.muteAudio=function(){vg.pause("bgm")},vg.unmuteAudio=function(){vg.bgmMuted||vg.play("bgm")};var audioSouces={bgm:"assets/audio/bgm.mp3",button:"assets/audio/button.mp3",end:"assets/audio/end.mp3",crash:"assets/audio/crash.mp3",crash2:"assets/audio/crash2.mp3",coin:"assets/audio/coin.mp3",jump:"assets/audio/jump.mp3",wing:"assets/audio/wing.mp3",magnet:"assets/audio/magnet.mp3",shield:"assets/audio/shield.mp3",coinBonus:"assets/audio/coin-bonus.mp3",hit:"assets/audio/ground-hit.mp3"},startLoadingAudio=function(){for(var e=new THREE.AudioListener,t=function(t){var i=new THREE.AudioLoader(vg.loadManager);vg.audio[t]=new THREE.Audio(e),i.load(audioSouces[t],function(e){vg.audio[t].setBuffer(e),vg.audio[t].setLoop("bgm"==t)})},i=Object.keys(audioSouces),o=0,n=i.length;o<n;o++)t(i[o])};(vg=vg||{}).fullscreen=vg.fullscreen||{};var isFullscreen=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},requestFullscreen=function(){try{var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}catch(e){}},exitFullscreen=function(){try{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}catch(e){}};function startLoadingAssets(){vg.models=[],new THREE.GLTFLoader(vg.loadManager).load("assets/models/objects.gltf",function(e){e.scene.children.forEach(function(e){vg.models.push(e)})}),new THREE.FBXLoader(vg.loadManager).load("assets/models/wing.fbx",function(e){var t=new THREE.AnimationMixer(e);vg.anims=vg.anims||{},vg.anims.flap=t.clipAction(e.animations[0]),vg.anims.mesh=e,vg.anims.mesh.position.set(0,.06,0),vg.anims.mixer=t,vg.anims.flap.play()}),new THREE.GLTFLoader(vg.loadManager).load("assets/models/RobotExpressive.glb",function(e){var t=e.scene,i=new THREE.AnimationMixer(t);vg.anims=vg.anims||{},vg.anims.botMesh=t,vg.anims.botMixer=i,vg.anims.running=i.clipAction(e.animations[6]),vg.anims.jump=i.clipAction(e.animations[3]),vg.anims.idle=i.clipAction(e.animations[2]),vg.anims.death=i.clipAction(e.animations[1])}),startLoadingAudio()}vg.toggleFullscreen=function(){isFullscreen()?exitFullscreen():requestFullscreen()},Input=function(){this.keys={mouse:-1,space:32,left:37,up:38,right:39},this.keyNames=Object.keys(this.keys),this.keyCodes=Object.values(this.keys),this.initMouse(),this.initKeyboard(),("ontouchstart"in window||window.navigator.msMaxTouchPoints)&&this.initTouches(),this.pressedKeys={},this.pressingKeys={},this.releasedKeys={}},Input.prototype.initMouse=function(){this.mouse={x:0,y:0};var e=document.getElementById("game");e.addEventListener("mousewheel",this.mousewheel.bind(this),!1),e.addEventListener("DOMMouseScroll",this.mousewheel.bind(this),!1),e.addEventListener("contextmenu",this.contextmenu.bind(this),!1),e.addEventListener("mousedown",this.keydown.bind(this),!1),e.addEventListener("mouseup",this.keyup.bind(this),!1),e.addEventListener("mousemove",this.mousemove.bind(this),!1)},Input.prototype.initTouches=function(){this.mouse={x:0,y:0};var e=document.getElementById("game");e.addEventListener("touchstart",this.keydown.bind(this),!1),e.addEventListener("touchend",this.keyup.bind(this),!1),e.addEventListener("touchmove",this.mousemove.bind(this),!1),e.addEventListener("MSPointerDown",this.keydown.bind(this),!1),e.addEventListener("MSPointerUp",this.keyup.bind(this),!1),e.addEventListener("MSPointerMove",this.mousemove.bind(this),!1),e.style.msTouchAction="none"},Input.prototype.initKeyboard=function(){document.addEventListener("keydown",this.keydown.bind(this),!1),document.addEventListener("keyup",this.keyup.bind(this),!1)},Input.prototype.mousewheel=function(e){var t=0<(e.wheelDelta?e.wheelDelta:-1*e.detail)?"wheelUp":"wheelDown";this.keys[t]&&(e.stopPropagation(),e.preventDefault(),this.pressedKeys[t]=!0,this.pressingKeys[t]=!0)},Input.prototype.contextmenu=function(e){this.keys.rightMouse&&(e.stopPropagation(),e.preventDefault())},Input.prototype.keydown=function(e){var t="keydown"==e.type?e.keyCode:2==e.button?this.keys.rightMouse:this.keys.mouse;"touchstart"!=e.type&&"mousedown"!=e.type||this.mousemove(e),-1<(t=this.keyCodes.indexOf(t))&&(t=this.keyNames[t],this.pressedKeys[t]=!0,this.pressingKeys[t]=!0,e.stopPropagation(),e.preventDefault())},Input.prototype.keyup=function(e){var t=this.keyCodes.indexOf("keyup"==e.type?e.keyCode:2==e.button?this.keys.rightMouse:this.keys.mouse);-1<t&&(t=this.keyNames[t],this.pressingKeys[t]=!1,this.releasedKeys[t]=!0,e.stopPropagation(),e.preventDefault())},Input.prototype.mousemove=function(e){e.touches?(this.mouse.x=e.touches[0].pageX,this.mouse.y=e.touches[0].pageY):(this.mouse.x=e.clientX,this.mouse.y=e.clientY)},Input.prototype.clear=function(){this.pressedKeys={},this.releasedKeys={}},Input.prototype.pressed=function(e){return this.pressedKeys[e]},Input.prototype.released=function(e){return this.releasedKeys[e]},Input.prototype.pressing=function(e){return this.pressingKeys[e]},(vg=vg||{}).input=new Input,(vg=vg||{}).devMode=!0,vg.ready=!1,vg.language="us",vg.paused=!1,vg.PI2=2*Math.PI,vg.log=function(e){this.devMode&&console.log("%c "+e+" ","background: #8deb9b; font-size: 14px;")},vg.shuffleArray=function(e){for(var t=e.length-1;0<t;t--){var i=Math.floor(Math.random()*(t+1)),o=e[t];e[t]=e[i],e[i]=o}},vg.randomBetween=function(e,t){return Math.random()*(t-e)+e},vg.randomInArray=function(e){return e[Math.floor(Math.random()*e.length)]},vg.getWorldPos=function(e){var t=new THREE.Vector3;return e.getWorldPosition(t),t},vg.copy=function(e){return{x:e.x,y:e.y}},vg.formatNumber=function(e){if(1e3>e)return e;var t=Math.floor(e/1e3);return 10>(e%=1e3)?t+",00"+e:100>e?t+",0"+e:t+","+e},vg.objects=[],vg.addObject=function(e){vg.objects.push(e),vg.scene.add(e.mesh)},vg.removeObject=function(e){var t=vg.objects.indexOf(e);-1<t&&vg.objects.splice(t,1),vg.scene.remove(e.mesh)},vg.pauseGame=function(){vg.paused||(vg.paused=!0,vg.muteAudio(),vg.log("Game paused"))},vg.resumeGame=function(){vg.paused&&!vg.menuVisible&&(vg.paused=!1,vg.unmuteAudio(),vg.log("Game resumed"))},$(window).blur(function(){vg.pauseGame()}),$(window).focus(function(){vg.resumeGame()}),(vg=vg||{}).lb={name:"RunningBotXmas",userLogged:!1,currentUserRank:0,init:function(){this.initPlayer(),this.initLeaderboard(),this.initElements()},initPlayer:function(e,t){console.log("Init Player"),ysdk.getPlayer().then(function(t){vg.lb.userLogged=!0,0<(t=vg.load("bestscore"))&&vg.lb.sendScore(t),"function"==typeof e&&setTimeout(e,500)}).catch(function(e){"function"==typeof t&&t()})},openAuthDialog:function(){ysdk.auth.openAuthDialog().then(function(){initPlayer()}).catch(function(){})},initLeaderboard:function(){console.log("Init Leaderboard"),ysdk.getLeaderboards().then(function(e){vg.lb.main=e})},initElements:function(){vg.lb.tag=$("div#leaderboard"),vg.lb.dataTag=$("div#lb-data"),vg.lb.footerLogin=$("div#lb-footer-2"),vg.lb.footers=$("div.lb-footer"),$("img#btLeaderboard").click(function(){vg.lb.getData()}),$("a#login").click(function(e){e.preventDefault(),vg.lb.openAuthDialog(),vg.lb.tag.hide()})},sendScore:function(e){vg.lb.main&&vg.lb.main.setLeaderboardScore(vg.lb.name,e)},getData:function(){vg.lb.main&&(vg.lb.dataTag.html(_TEXT[vg.language].Loading),vg.lb.footers.hide(),vg.lb.tag.fadeIn(),vg.lb.main.getLeaderboardEntries(vg.lb.name,{quantityTop:10,includeUser:vg.lb.userLogged,quantityAround:1}).then(function(e){vg.lb.currentUserRank=e.userRank,vg.lb.showData(e.entries)}),vg.lb.userLogged||this.initPlayer(this.getData.bind(this),function(){vg.lb.footerLogin.show()}))},showData:function(e){if(0==e.length)vg.lb.dataTag.html(_TEXT[vg.language].NoEntries);else{for(var t="",i=0;i<e.length;i++){var o=e[i],n=vg.lb.currentUserRank!==o.rank?"":" lb-currentUser",s=9==i&&12<vg.lb.currentUserRank?" separate":"",a=o.player.publicName;""==a&&(a=_TEXT[vg.language].Anonymous),t+='<div class="row'+n+s+'"><div class="column lb-rank">'+o.rank+'</div><div class="column lb-username">'+a+'</div><div class="column lb-score">'+o.score.toLocaleString()+"</div></div>"}vg.lb.dataTag.html(t)}}},(vg=vg||{}).loadManager=new THREE.LoadingManager,vg.loadManager.onLoad=function(){initGame()},(vg=vg||{}).storagePrefix="VG-RunningBot-Xmas-v1.0.0-";try{localStorage.setItem("test","test"),localStorage.removeItem("test"),vg.storage=localStorage}catch(e){vg.log("localStorage is not supported!"),vg.storage={setItem:function(e,t){vg.storage[e]=t},getItem:function(e){return vg.storage[e]},removeItem:function(e){delete vg.storage[e]}}}vg.initKey=function(e,t){null==vg.load(e)&&vg.save(e,t)},vg.save=function(e,t){this.storage.setItem(this.storagePrefix+e,JSON.stringify(t))},vg.load=function(e){return void 0===(e=this.storage.getItem(this.storagePrefix+e))?null:JSON.parse(e)},vg.initKey("bgmMuted",0),vg.initKey("sfxMuted",0),vg.initKey("bestscore",0),vg.initKey("mushroom",0),vg.initKey("language","us"),vg.initKey("langDetected",0),vg.initKey("magnet",1),vg.initKey("shield",1),vg.initKey("health",1),(vg=vg||{}).Timer=function(){this.timers=[],this.timerPool=[],Timeout=function(e,t,i){var o={};return o.manager=i,o.restart=function(){o.time=0,o.isStopped=!1},o.reset=function(e,t){o.callback=e,o.maxTime=t,o.restart()},o.reset(e,t),o.stop=function(){o.isStopped=!0,o.manager.remove(o)},o.end=function(){o.stop(),o.callback()},o.update=function(){o.isStopped||(o.time+=vg.time.elapsed,o.time>o.maxTime&&o.end())},o},this.setTimeout=function(e,t){if(0<this.timerPool.length){var i=this.timerPool.pop();i.reset(e,t)}else i=new Timeout(e,t,this);return this.timers.push(i),i},this.remove=function(e){-1<(e=this.timers.indexOf(e))&&this.timerPool.unshift(this.timers.splice(e,1)[0])},this.update=function(){for(var e=0;e<this.timers.length;e++)this.timers[e].update()}},(vg=vg||{}).ua={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob},vg.ua.pixelRatio=window.devicePixelRatio||1,vg.ua.screen={width:window.screen.availWidth*vg.ua.pixelRatio,height:window.screen.availHeight*vg.ua.pixelRatio},vg.ua.iPhone=/iPhone/i.test(navigator.userAgent),vg.ua.iPhone4=vg.ua.iPhone&&2==vg.ua.pixelRatio,vg.ua.iPad=/iPad/i.test(navigator.userAgent),vg.ua.android=/android/i.test(navigator.userAgent),vg.ua.winPhone=/Windows Phone/i.test(navigator.userAgent),vg.ua.is_uiwebview=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent),vg.ua.is_safari_or_uiwebview=/(iPhone|iPod|iPad).*AppleWebKit/i.test(navigator.userAgent),vg.ua.iOS=vg.ua.iPhone||vg.ua.iPad,vg.ua.iOS6_tag=/OS 6_/i.test(navigator.userAgent),vg.ua.iOS6=(vg.ua.iPhone||vg.ua.iPad)&&vg.ua.iOS6_tag,vg.ua.iOSgt5=vg.ua.iOS&&5<parseInt(navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/)[1]),vg.ua.HTCONE=/HTC_One/i.test(navigator.userAgent),vg.ua.winPhone=/Windows Phone/i.test(navigator.userAgent),vg.ua.Kindle=/Silk/i.test(navigator.userAgent),vg.ua.touchDevice="ontouchstart"in window||window.navigator.msMaxTouchPoints,vg.ua.mobile=vg.ua.iOS||vg.ua.android||vg.ua.iOS6||vg.ua.winPhone||vg.ua.Kindle||/mobile/i.test(navigator.userAgent),(vg=vg||{}).menuVisible=!1,$(".button, img.buttonMenu").click(function(){vg.play("button"),$(this).hasClass("buttonVideo")||vgAds.showAd()});var menuBox=$("#menuBox"),btMenu=$("#btMenu"),menu=$("#menu");btMenu.click(function(){btMenu.hasClass("change")?vg.hideMenu():vg.showMenu()}),vg.showMenu=function(){vg.menuVisible||(btMenu.addClass("change"),vg.menuVisible=!0,menu.fadeIn(),menuBox.animate({right:"10px"},"fast","linear"),vg.pauseGame())},vg.hideMenu=function(){menu.fadeOut(),btMenu.removeClass("change"),menuBox.animate({right:"-100px"},"fast","linear",function(){vg.menuVisible=!1,vg.resumeGame()})};var handleBgmButton=function(){vg.bgmMuted?($("img#btBGM-off").show(),$("img#btBGM-on").hide(),vg.stop("bgm")):($("img#btBGM-off").hide(),$("img#btBGM-on").show(),vg.audioContextResumed&&vg.play("bgm"))},handleSFXButton=function(){vg.sfxMuted?($("img#btSFX-off").show(),$("img#btSFX-on").hide()):($("img#btSFX-off").hide(),$("img#btSFX-on").show())};vg.bgmMuted=1==vg.load("bgmMuted"),vg.sfxMuted=1==vg.load("sfxMuted"),handleBgmButton(),handleSFXButton(),$("img#btBGM-off, img#btBGM-on").click(function(){vg.bgmMuted=!vg.bgmMuted,vg.save("bgmMuted",vg.bgmMuted),handleBgmButton()}),$("img#btSFX-off, img#btSFX-on").click(function(){vg.sfxMuted=!vg.sfxMuted,vg.save("sfxMuted",vg.sfxMuted),handleSFXButton()}),$("img#btMoregames").click(function(){ysdk&&window.open("https://yandex."+("ru"==ysdk.environment.i18n.lang?"ru":"com")+"/games/search?query=gamesJS","_blank")});var btContinue=$("button#btContinue");vg.setLanguage=function(e){vg.language=e,$(".btLanguage").hide(),$("#"+e).show(),vg.save("language",e);var t,i=_TEXT[e];for(t in i)Object.prototype.hasOwnProperty.call(i,t)&&$(".text-"+t).html(_TEXT[e][t]);(i={}).width="us"==e?"137px":"170px",btContinue.css(i),void 0!==Game&&Game.over&&Game.control.updateBestScoreText()},vg.setLanguage(vg.load("language")),$(".btLanguage").click(function(){var e=$(this).attr("alt");vg.setLanguage(e)});var leaderboard=$("div#leaderboard");window.onclick=function(e){e.target==upgradeShop.get(0)?(upgradeShop.fadeOut(),vg.showBtCoin(),vgAds.showAd()):e.target==leaderboard.get(0)?leaderboard.fadeOut():e.target==menu.get(0)?(vg.hideMenu(),vgAds.showAd()):"tutorial"==e.target.id?($(e.target).fadeOut(),Game.control.startGame(),vgAds.showAd()):$(e.target).hasClass("marked")&&Game.control.awaitContinue&&Game.control.continue()},$("img#btReplay").click(function(){Game.control.restartGame()});var upgradeShop=$("div#upgradeShop"),btCoin=$("button#btCoin");function checkItem(e){var t=vg.load(e),i=$("div#"+e),o=i.find("div.details-content>span:last-child"),n=(i=i.find(".btAction")).find("span").first(),s={magnet:{price:[200,600],text:["8s","10s","12s"]},shield:{price:[200,600],text:["8s","10s","12s"]},health:{price:[500,1e3],text:["3","4","5"]}};o.first().html(t+"/3"),o.last().html(s[e].text[t-1]),3==t?i.hide():(e=s[e].price[t-1],n.html(e),e>Game.control.mushroomCollected?i.hasClass("disabled")||i.addClass("disabled"):i.hasClass("disabled")&&i.removeClass("disabled"))}function updateShop(){checkItem("magnet"),checkItem("shield"),checkItem("health")}function openPage(e,t,i){var o,n=document.getElementsByClassName("tabcontent");for(o=0;o<n.length;o++)n[o].style.display="none";for(n=document.getElementsByClassName("tablink"),o=0;o<n.length;o++)n[o].style.backgroundColor="";document.getElementById(e).style.display="block",t.style.backgroundColor=i}vg.showBtCoin=function(){vgAds&&vgAds.isRVReady()&&btCoin.show()},vg.hideBtCoin=function(){btCoin.is(":visible")&&btCoin.hide()},vg.showBtContinue=function(){vgAds&&vgAds.isRVReady()&&btContinue.show()},vg.hideBtContinue=function(){btContinue.is(":visible")&&btContinue.hide()},$("img#btUpgrade").click(function(){updateShop(),Game.mushroomText.css({color:"yellow"}),upgradeShop.fadeIn(),vg.hideBtCoin()}),$("div.btAction").click(function(){var e=$(this).find("span").first();if(e=parseInt(e.text()),0>(e=Game.control.mushroomCollected-e))showSnack(_TEXT[vg.language].NotEnough);else{Game.control.updateMushroom(e),e=$(this).data("item");var t=vg.load(e);Game.control.setupItem(e,++t),showSnack(_TEXT[vg.language].ItemBought),updateShop()}}),$("span.close").click(function(){vg.play("button");var e=$(this).parent().parent();e.fadeOut(),"upgradeShop"==e.attr("id")?(upgradeShop.fadeOut(),vg.showBtCoin()):"tutorial"==e.attr("id")&&Game.control.startGame(),vgAds.showAd()});var snackTime,snackbar=$("div#snackbar");function showSnack(e){snackbar.html(e),snackbar.hasClass("show")?clearTimeout(snackTime):snackbar.addClass("show"),snackTime=setTimeout(function(){snackbar.removeClass("show")},3e3)}function getObjectAt(e){return 0<(e=vg.models[e]).children.length?e.children.forEach(function(e){e.material.flatShading=!0,e.material.needsUpdate=!0,e.receiveShadow=!1,e.castShadow=vg.shadow}):(e.material.flatShading=!0,e.material.needsUpdate=!0,e.receiveShadow=!1,e.castShadow=vg.shadow),e.clone()}$("button.buttonVideo").click(function(){var e=$(this);e.hide(),e=e.data("reward"),vg.rewardType=e,vgAds.showRVAd(vg.reward)}),vg.reward=function(){switch(vg.rewardType){case"coin":Game.control.animCount=3,Game.control.animateMushroom();break;case"continue":Game.control.showContinue()}},Ball=function(){var e,t=e=Game.worldRadius+.22-.128;return this.mesh=new THREE.Object3D,this.setupSkin=function(){var e=.12,t=1;vg.ua.mobile&&768>window.innerWidth&&810>window.innerHeight&&(e=.15,t=1.42,vg.anims.mesh.position.set(0,.06*t,0)),vg.anims.botMesh.scale.set(e,e,e),vg.anims.botMesh.position.set(0,-.25,0),vg.anims.botMesh.rotation.y=Math.PI,this.mesh.add(vg.anims.botMesh),vg.anims.mesh.scale.set(.0062*t,.0062*t,.0062*t),this.effect.mesh.scale.set(.35*t,.35*t,.35*t),this.protector.mesh.scale.set(.35*t,.35*t,.35*t)},this.changeAnimTo=function(e,t){this.currentAnim&&this.currentAnim.fadeOut(.2),this.currentAnim=vg.anims[e],t&&this.currentAnim.setEffectiveTimeScale(t),"death"==e&&(this.currentAnim.setLoop(THREE.LoopOnce),this.currentAnim.clampWhenFinished=!0),this.currentAnim.reset().setEffectiveWeight(1).fadeIn(.2).play()},this.bonusHealth=0,this.reset=function(){this.mesh.position.y=t,this.currentLane=0,this.jumping=!1,this.health=3+this.bonusHealth,this.collisionReady=!0,this.bounceValue=.01,this.resetHealth(),this.changeAnimTo("running")},this.resetHealth=function(){for(var e=0;e<this.health;e++)$(Game.health[e]).show()},this.protector=new Protector,this.showProtector=function(){this.protector.fadeIn(),this.mesh.add(this.protector.mesh)},this.hideProtector=function(){this.protector.flashing()},this.effect=new CollisionEffect,this.colliding=function(){if(Game.over)vg.play("crash2");else if(Game.control.shieldActive)vg.play("crash2");else if(this.collisionReady){this.effect.flashing(),this.mesh.add(this.effect.mesh),this.collisionReady=!1,this.health--;for(var e=Game.health.length-1;-1<e;e--){var t=$(Game.health[e]);if(t.is(":visible")){t.hide();break}}0===this.health?(Game.control.gameOver(),vg.play("end")):vg.play("crash")}},this.floating=!1,this.floatingY=36.3,vg.anims.mesh.rotation.x=-Math.PI/6,this.showWings=function(){this.mesh.rotation.x=0,this.mesh.add(vg.anims.mesh),this.changeAnimTo("idle")},this.hideWings=function(){this.mesh.remove(vg.anims.mesh),Game.ball.jumping=!0},this.setupSkin(),this.reset(),this.mesh.position.x=this.currentLane,this.clickedPos={x:0,y:0},this.input={left:!1,right:!1,jump:!1},this.update=function(){if(vg.anims.botMixer.update(vg.time.elapsed),Game.control.wingsActive)vg.anims.mixer.update(1.2*vg.time.elapsed),this.floating&&(this.mesh.position.y=this.floatingY+.05*Math.cos(vg.time.now/90));else{var i=this.bounceValue*vg.time.adjust;this.mesh.position.y+=i,this.mesh.position.y<=t&&(this.mesh.position.y=t,Game.over||(-.25>i&&vg.play("hit"),this.bounceValue=.025*Math.random()),this.jumping&&(this.jumping=!1,this.changeAnimTo("running"))),this.bounceValue-=Game.gravity*vg.time.adjust}if(this.mesh.position.x=THREE.Math.lerp(this.mesh.position.x,this.currentLane,3*vg.time.elapsed),!this.jumping&&!Game.over){if(vg.input.pressed("mouse")&&(this.clickedPos=vg.copy(vg.input.mouse)),vg.input.released("mouse")){var o=vg.input.mouse;i=this.clickedPos.y-o.y,o=this.clickedPos.x-o.x;var n=Math.abs(i);(5<Math.abs(o)||5<n)&&(Math.abs(o)>Math.abs(i)?0>o?this.input.right=!0:this.input.left=!0:this.input.jump=!0)}vg.input.pressed("left")&&(this.input.left=!0),vg.input.pressed("right")&&(this.input.right=!0),vg.input.pressed("up")&&(this.input.jump=!0),i=!0,this.input.left?0==this.currentLane?(this.currentLane=-1,t=e-.03):1==this.currentLane?(this.currentLane=0,t=e):i=!1:this.input.right?0==this.currentLane?(this.currentLane=1,t=e-.03):-1==this.currentLane?(this.currentLane=0,t=e):i=!1:(this.input.jump&&!Game.control.wingsActive&&(this.bounceValue=.1,this.jumping=!0,vg.play("jump"),this.changeAnimTo("jump",1)),i=!1),i&&!Game.control.wingsActive&&(this.jumping=!0,this.bounceValue=.05,vg.play("jump"),this.changeAnimTo("jump",1.32)),this.input={left:!1,right:!1,jump:!1}}},this},Cube=function(e,t){var i=new THREE.BoxGeometry(1,1,1);e=new THREE.MeshPhongMaterial({color:e}),this.mesh=new THREE.Mesh(i,e),this.mesh.position.x=t;var o=1+Math.random();return this.update=function(){var e=vg.time.now*o*.001;this.mesh.rotation.x=e,this.mesh.rotation.y=e},this},Ground=function(){this.accel=1.5e-7,this.rollingSpeed=Game.groundRollingSpeed,this.increaseSpeed=!0,this.mesh=getObjectAt(5),this.mesh.position.set(0,0,0),this.mesh.castShadow=!1,this.mesh.receiveShadow=vg.shadow;var e=vg.PI2/40,t=Game.worldRadius-.4;return this.leftTreeRoller=new Roller(Tree,6,e,t,4),this.rightTreeRoller=new Roller(Tree,6,e,t,-4),this.mesh.add(this.leftTreeRoller.mesh),this.mesh.add(this.rightTreeRoller.mesh),this.update=function(){if(this.increaseSpeed){this.rollingSpeed+=this.accel*vg.time.adjust,vg.anims.running.setEffectiveTimeScale(300*this.rollingSpeed);var e=.01133*vg.time.adjust;this.rollingSpeed>e?(this.rollingSpeed=e,this.increaseSpeed=!1):0>=this.rollingSpeed&&(this.rollingSpeed=0,Game.ball.changeAnimTo("death"),this.increaseSpeed=!1,vg.save("mushroom",Game.control.mushroomCollected),Game.control.setupBestScore(),Game.control.showOverBox())}this.mesh.rotation.x+=this.rollingSpeed,this.leftTreeRoller.update(),this.rightTreeRoller.update()},this.reset=function(){this.rollingSpeed=Game.groundRollingSpeed,this.increaseSpeed=!0,this.accel=2e-7},this},GameObject=function(e){return this.pool=e,this.touchDistance=.55,this.update=function(){var e=vg.getWorldPos(this.mesh);if(!(-5>e.z)){var t=Game.ball.mesh.position.clone();this.touchBall(e,t)?this.kill(1):3<e.z&&this.kill()}},this.kill=function(e){this.pool.remove(this),Game.control.removeObj(this),this.handleKill(e)},this.touchBall=function(e,t){return t.sub(e).length()<this.touchDistance},this.handleKill=function(e){},this},Mushroom=function(e){var t=new GameObject(e);return t.mesh=getObjectAt(7),t.moveToBall=function(){var e=Game.ball.mesh.position.clone();e.y-=.2;var i=Game.control.mesh;Game.control.wingsActive?(i=Game.control.sky.mesh,e.z-=1.5*vg.time.adjust):e.z-=1*vg.time.adjust,e=i.worldToLocal(e),t.mesh.position.lerp(e,.1*vg.time.adjust)},t.followBall=!1,t.touchBall=function(e,i){return.55>(e=i.sub(e)).length()||(Game.control.magnetActive&&5>e.length()&&!t.followBall&&(t.followBall=!0,t.followTime=vg.time.now),t.followBall&&(t.moveToBall(),500<vg.time.now-t.followTime&&t.kill(1)),!1)},t.handleKill=function(e){t.followBall&&(t.followBall=!1),t.sky&&t.sky.addNewMushroom(),e&&(vg.play("coin"),Game.control.updateMushroom(++Game.control.mushroomCollected))},t},Tree=function(e){return(e=new GameObject(e)).mesh=getObjectAt(0),e.mesh.scale.set(.22,.22,.22),e.touchBall=function(e,t){return-.2<e.z&&.2>Math.abs(e.x-t.x)&&1.5>Math.abs(e.y-t.y)},e.handleKill=function(e){e&&Game.ball.colliding()},e},Rock=function(e){return(e=new GameObject(e)).mesh=getObjectAt(1),e.mesh.scale.set(.22,.45,.22),e.handleKill=function(e){e&&Game.ball.colliding()},e},Magnet=function(e){return(e=new GameObject(e)).mesh=getObjectAt(2),e.mesh.scale.set(.06,.24,.06),e.handleKill=function(e){e&&(vg.play("magnet"),Game.control.activateMagnet()),Game.control.magnetExist=!1},e},Shield=function(e){return(e=new GameObject(e)).mesh=getObjectAt(3),e.mesh.scale.set(.124,.151,.0241),e.handleKill=function(e){e&&(vg.play("shield"),Game.control.activateShield()),Game.control.shieldExist=!1},e},Wings=function(e){return(e=new GameObject(e)).mesh=getObjectAt(4),e.mesh.scale.set(.013,.006,.004),e.handleKill=function(e){e&&(Game.control.activateWings(),vg.play("wing")),Game.control.wingsExist=!1},e},Protector=function(e){var t={};return t.ball=e,t.mesh=getObjectAt(6),t.mesh.scale.set(.3,.3,.3),t.mesh.position.set(0,.05,0),t.flashingTime=3.5,t.isFlashing=!1,t.fadeIn=function(){t.mesh.material.opacity=0,new TWEEN.Tween(t.mesh.material).to({opacity:.15},300).start()},t.flashing=function(){t.isFlashing=!0,t.flashingTween=new TWEEN.Tween(t.mesh.material).to({opacity:.02},500).repeat(6).yoyo(!0).onComplete(function(){t.stopProtection()}).start()},t.stopFlashing=function(){t.isFlashing=!1,t.flashingTween.stop(),t.mesh.material.opacity=.15},t.stopProtection=function(){Game.ball.mesh.remove(t.mesh),t.isFlashing=!1,Game.control.shieldActive=!1},t},CollisionEffect=function(){var e={};e.mesh=getObjectAt(6);var t=e.mesh.material.clone();return t.color.set(16711680),t.emissive.set(16711680),e.mesh.material=t,e.mesh.scale.set(.22,.22,.22),e.mesh.position.set(0,.05,0),e.mesh.material.opacity=.02,e.flashing=function(){new TWEEN.Tween(e.mesh.material).to({opacity:.15},300).yoyo(!0).onComplete(function(){Game.ball.mesh.remove(e.mesh),Game.ball.collisionReady=!0}).start()},e},Particle=function(){var e=new THREE.TetrahedronGeometry(3,0),t=new THREE.MeshPhongMaterial({color:39321,shininess:0,specular:16777215,flatShading:THREE.FlatShading});this.mesh=new THREE.Mesh(e,t)},Particle.prototype.explode=function(e,t,i){var o=this,n=this.mesh.parent;this.mesh.material.color=new THREE.Color(t),this.mesh.material.needsUpdate=!0,this.mesh.scale.set(i,i,i),t=e.x+50*(2*Math.random()-1),e=e.y+50*(2*Math.random()-1),i=.6+.2*Math.random(),new TWEEN.Tween(o.mesh.rotation).to({x:12*Math.random(),y:12*Math.random()},i).start(),new TWEEN.Tween(o.mesh.scale).to({x:.1,y:.1,z:.1},i).start(),new TWEEN.Tween(o.mesh.position).to({x:t,y:e},i).delay(.1*Math.random()).easing(TWEEN.Easing.Quadratic.Out).onComplete(function(){n&&n.remove(o.mesh),o.mesh.scale.set(1,1,1),o.particlesPool.unshift(o)}).start()},ParticlesPool=function(){this.mesh=new THREE.Object3D,this.particlesInUse=[],this.particlesPool=[];for(var e=0;10>e;e++){var t=new Particle;this.particlesPool.push(t)}vg.scene.add(this.mesh)},ParticlesPool.prototype.spawnParticles=function(e,t,i,o){for(var n=0;n<t;n++){var s=this.particlesPool.length?this.particlesPool.pop():new Particle;this.mesh.add(s.mesh),s.mesh.visible=!0,s.mesh.position.y=e.y,s.mesh.position.x=e.x,s.explode(e,i,o)}},Pool=function(e,t){this.type=e,this.mesh=new THREE.Object3D,this.objectInUse=[],this.objectPool=[];for(var i=0;i<t;i++){var o=new e(this);this.objectPool.push(o)}return this},Pool.prototype.add=function(){var e=this.objectPool.length?this.objectPool.pop():new this.type(this);return this.mesh.add(e.mesh),this.objectInUse.push(e),e},Pool.prototype.remove=function(e){var t=this.objectInUse.indexOf(e);-1<t&&(this.objectPool.unshift(this.objectInUse.splice(t,1)[0]),this.mesh.remove(e.mesh))},Roller=function(e,t,i,o,n){for(this.mesh=new THREE.Object3D,this.group=[],this.angleStep=i,this.angle=Math.random()*i,this.radius=o,this.x=n,i=0;i<t;i++)o=new e(this),this.placeObject(o),this.mesh.add(o.mesh);return this},Roller.prototype.placeObject=function(e){placeObject(e,this.angle,this.radius+vg.randomBetween(-.17,-.07),this.x),this.angle+=this.angleStep*(1+.3*Math.random()),this.angle>vg.PI2&&(this.angle-=vg.PI2),this.group.push(e)},Roller.prototype.update=function(){if(3<vg.getWorldPos(this.group[0].mesh).z){var e=this.group.shift();this.placeObject(e)}},Sky=function(){this.mesh=new THREE.Object3D,vg.scene.add(this.mesh),this.speedRatio=Game.worldRadius/Game.ball.floatingY*1.5,this.skyMushroomPool=new Pool(Mushroom,6),this.mesh.add(this.skyMushroomPool.mesh),this.r=Game.ball.floatingY-.08,this.setup=function(){this.totalMushrooms=0,this.mesh.rotation.x=0,this.angle=.68*Math.PI;for(var e=0;6>e;e++)this.addNewMushroom()},this.addNewMushroom=function(){if(!(22<this.totalMushrooms)){this.totalMushrooms++;var e=Math.floor(3*Math.random())-1,t=this.skyMushroomPool.add();placeObject(t,this.angle,this.r,e),void 0===t.sky&&(t.sky=this),this.angle+=Game.minSpawnAngle*this.speedRatio*.18}},this.update=function(){this.mesh.rotation.x+=Game.groundRollingSpeed*this.speedRatio*vg.time.elapsed*60;for(var e=0;e<this.skyMushroomPool.objectInUse.length;e++)this.skyMushroomPool.objectInUse[e].update()}};var Colors={red:15881030,white:14209233,brown:5845806,brownDark:2300175,pink:16095342,yellow:16043667,blue:6865856},Game={worldRadius:26,groundRollingSpeed:.005,gravity:.005,minSpawnAngle:Math.PI/7,leanAngle:Math.PI/24,over:!1,scoreText:$("div#score"),magnet:$("div#icon-magnet"),health:$("div#icon-health>img"),mushroom:$("span#mushroomCollected"),overBox:$("div#gameOver"),result:$("div#result"),best:$("div#best"),mushroomText:$("div#mushroom"),guideText:$("div#gameOver .text-TapToContinue"),guide:$("div#gameOver div.guide"),overUI:$("div#gameOver div.overUI")},State={AwaitStart:0,Running:1,Paused:2,GameOver:3};function addObjects(){vg.addObject(Game.ground=new Ground),vg.addObject(Game.ball=new Ball),vg.addObject(Game.control=new Control)}function placeObject(e,t,i,o,n){(e=e.mesh).position.y=Math.sin(t)*i,e.position.z=Math.cos(t)*i,e.position.x=o,e.rotation.x=Math.PI/2-t,n&&(e.rotation.x+=vg.randomBetween(-Game.leanAngle,Game.leanAngle),e.rotation.y=vg.randomBetween(0,vg.PI2),e.rotation.z=vg.randomBetween(-Game.leanAngle,Game.leanAngle))}function setupScene(){var e=document.querySelector("#game"),t=!vg.ua.mobile;vg.shadow=!0,e=new THREE.WebGLRenderer({antialias:t,canvas:e}),vg.renderer=e,e.setClearColor(16775930,1),e.shadowMap.enabled=vg.shadow,e.shadowMap.type=THREE.PCFSoftShadowMap,e.outputEncoding=THREE.sRGBEncoding,e.setSize(window.innerWidth,window.innerHeight),e.setPixelRatio(window.devicePixelRatio);var i=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,22.2);vg.camera=i,i.repos=function(){if(830>window.innerWidth){var e=830/window.innerWidth;i.position.z=2.7*e,i.posY0=27.2+1.2*(e-1)}else i.position.z=2.7,i.posY0=27.2;i.position.y=Game&&Game.control&&Game.control.wingsActive?window.innerWidth<window.innerHeight?i.position.y+1.08:i.position.y-1.08:i.posY0},i.repos(),e=new THREE.Scene,vg.ua.mobile||(e.fog=new THREE.FogExp2(15794160,.058)),vg.scene=e,t=new THREE.HemisphereLight(16775930,0,.3),e.add(t),t=new THREE.DirectionalLight(13484485,.6),e.add(t),t.position.set(30,30,-30),vg.shadow&&(t.castShadow=vg.shadow,t.shadow.camera.near=1,t.shadow.camera.far=50,t.shadow.camera.left=-25,t.shadow.camera.right=25,t.shadow.camera.top=25,t.shadow.camera.bottom=-25)}function baseUpdate(){vg.objects.forEach(function(e){e.update()})}function loop(e){if(requestAnimationFrame(loop),vg.time.elapsed=e-vg.time.now,16.67>vg.time.elapsed?vg.time.elapsed=16.7:33.3<vg.time.elapsed&&(vg.time.elapsed=33.3),vg.time.elapsed/=1e3,vg.time.now=e,vg.time.adjust=60*vg.time.elapsed,!vg.paused)for(baseUpdate(),vg.input.clear(),TWEEN.update(),vg.renderer.render(vg.scene,vg.camera);16.67>performance.now()-e;);}function setupSizeHandler(){vg.halfWidth=window.innerWidth/2,vg.halfHeight=window.innerHeight/2,$(window).resize(function(){if(vg.resize(),vg.ua.iOS)for(var e=0;2>e;e++)setTimeout(function(){vg.resize()},300*(e+1))})}function startLoop(){vg.time.interval=1e3/vg.time.fps,requestAnimationFrame(loop)}function initGame(){setupScene(),setupSizeHandler(),addObjects(),startLoop(),$("#loading").fadeOut()}Control=function(){function e(e,t){return e=new Pool(e,t),i.mesh.add(e.mesh),e}function t(e){return e>vg.PI2&&(e-=vg.PI2),e}this.awaitStart=1,this.magnetExist=!1,this.showTutorial=!0,this.shieldActive=this.shieldExist=this.magnetActive=!1,this.mesh=new THREE.Object3D,this.rotateGroup=[],this.awaitContinue=this.awaitRestart=!1;var i=this;return this.timer=new vg.Timer,this.wingsActive=this.wingsExist=!1,this.wingsTime=8.28,this.sky=new Sky,this.setupItem=function(e,t){switch(t?vg.save(e,t):t=vg.load(e),e){case"magnet":this.magnetTime=6+2*t;break;case"shield":this.shieldTime=6+2*t;break;case"health":for(Game.ball.bonusHealth=t-1,Game.ball.health=3+Game.ball.bonusHealth,e=0,t=Game.ball.health;e<t;e++)$(Game.health[e]).show()}},this.setupItem("magnet"),this.setupItem("shield"),this.setupItem("health"),this.updateMushroom=function(e){this.mushroomCollected=e,Game.mushroom.text(vg.formatNumber(this.mushroomCollected)),vg.save("mushroom",this.mushroomCollected)},this.treePool=e(Tree,6),this.rockPool=e(Rock,6),this.mushroomPool=e(Mushroom,6),this.magnetPool=e(Magnet,1),this.shieldPool=e(Shield,1),this.wingsPool=e(Wings,1),this.spawnNextObjects=function(){function e(e){e="r"===e?.5>Math.random()?"tree":"rock":e;var t=s.splice(Math.floor(Math.random()*s.length),1)[0];switch(e){case"tree":var o=i.treePool.add(),n=Game.worldRadius-(0===t?.2:.25)+vg.randomBetween(-.1,-.07);break;case"rock":o=i.rockPool.add(),n=Game.worldRadius-(0===t?.2:.23)+vg.randomBetween(-.2,-.01)}return placeObject(o,i.nextAngle,n,t,1),i.rotateGroup.push(o),{type:e,x:t}}function o(e,t){var o=Game.worldRadius;if(0!==e&&(o-=.05),t){if(o+=1,.1>(t=Math.random())&&!i.wingsExist){var n=i.wingsPool.add();o+=.12,i.wingsExist=!0}else.2>t&&!i.shieldExist?(n=i.shieldPool.add(),o+=.15,i.shieldExist=!0):.3>t&&!i.magnetExist?(n=i.magnetPool.add(),i.magnetExist=!0):.4>Math.random()&&(n=i.mushroomPool.add());n&&(placeObject(n,i.nextAngle,o,e),i.rotateGroup.push(n))}else if(.4>Math.random())for(n=Math.floor(6*Math.random()),t=0;t<n;t++){var s=i.mushroomPool.add();placeObject(s,i.nextAngle+1.2/Game.worldRadius*t,o,e),i.rotateGroup.push(s)}}var n=Math.random(),s=[-1,0,1];if(300>this.score)var a=.05,r=.7;else 600>this.score?(a=.1,r=.8):(a=.3,r=.9);if(n<a){var l=e("rock");e("r"),e("r"),o(l.x,1)}else if(n<r)if(n=e("r"),a=e("r"),"rock"==n.type?l=n:"rock"==a.type&&(l=a),l&&.5>Math.random())o(l.x,1);else{var u=[n.x,a.x];o(l=[-1,0,1].filter(function(e){return!u.includes(e)})[0],0)}else if("rock"==(l=e("r")).type&&.33>Math.random())o(l.x,1);else{var h=[l.x];o((l=[-1,0,1].filter(function(e){return!h.includes(e)}))[.5>Math.random()?0:1],0)}this.nextAngle+=vg.randomBetween(Game.minSpawnAngle,1.1*Game.minSpawnAngle),this.nextAngle=t(this.nextAngle)},this.spawnInitialObjects=function(){for(var e=0;5>e;e++)this.spawnNextObjects()},this.hideOverBox=function(){Game.overBox.fadeOut(),Game.mushroomText.css({color:"#d6483b"})},this.showOverBox=function(){Game.overUI.is(":hidden")&&Game.overUI.show(),vg.ua.mobile?Game.guide.hide():(Game.guideText.html(_TEXT[vg.language].SpaceToRestart),Game.guide.show()),Game.overBox.fadeIn(),Game.mushroomText.css({color:"yellow"}),vg.ua.mobile||(this.awaitRestart=!0),vg.showBtCoin(),vg.showBtContinue()},this.showContinue=function(){this.awaitRestart=!1,this.awaitContinue=!0,Game.overUI.hide(),vg.ua.mobile?Game.guideText.html(_TEXT[vg.language].TapToContinue):Game.guideText.html(_TEXT[vg.language].SpaceToContinue),Game.guide.is(":hidden")&&Game.guide.show()},this.continue=function(){this.awaitContinue=!1,Game.over=!1,Game.ground.reset(),Game.ball.reset(),this.hideOverBox(),vg.hideBtCoin(),vg.hideBtContinue()},this.setupBestScore=function(){var e=vg.load("bestscore");(this.bestscore=this.score>e)&&(vg.save("bestscore",this.score),vg.lb.sendScore(this.score)),this.updateBestScoreText()},this.updateBestScoreText=function(){if(this.awaitContinue)vg.ua.mobile?Game.guideText.html(_TEXT[vg.language].TapToContinue):Game.guideText.html(_TEXT[vg.language].SpaceToContinue);else{if(Game.result.html(_TEXT[vg.language].Distance+vg.formatNumber(this.score)+"m"),this.bestscore)Game.best.html(_TEXT[vg.language].NewBest),Game.best.css({color:"#fcff4b"});else{var e=vg.load("bestscore");Game.best.html(_TEXT[vg.language].YourBest+vg.formatNumber(e)+"m"),Game.best.css({color:"#ffc697"})}this.awaitRestart&&Game.guideText.html(_TEXT[vg.language].SpaceToRestart)}},this.mushroomCollected=vg.load("mushroom"),Game.mushroom.text(vg.formatNumber(this.mushroomCollected)),this.reset=function(){for(;0<this.rotateGroup.length;)this.rotateGroup.shift().kill();this.nextAngle=.75*Math.PI,this.checkAngle=this.totalAngle=this.score=this.mesh.rotation.x=0,Game.scoreText.html("0"),this.continue(),this.spawnInitialObjects(),Game.ball.resetHealth()},this.startGame=function(){this.reset(),this.showTutorial=!1},this.restartGame=function(){this.reset(),this.hideOverBox(),vg.hideBtCoin(),vg.hideBtContinue()},this.animCount=3,this.animateMushroom=function(){0===this.animCount?(this.updateMushroom(this.mushroomCollected+300),vg.play("coinBonus")):(this.animCount--,Game.mushroom.animate({fontSize:"2em"},200,function(){Game.mushroom.animate({fontSize:"1em"},200,function(){this.animateMushroom()}.bind(this))}.bind(this)))},this.showTutorial&&(vg.ua.mobile?$("div#mobile").show():$("div#desktop").show(),$("div#tutorial").fadeIn()),this.update=function(){if(!this.showTutorial){this.timer.update(),this.mesh.rotation.x+=Game.ground.rollingSpeed*vg.time.adjust,this.mesh.rotation.x=t(this.mesh.rotation.x),this.totalAngle+=Game.ground.rollingSpeed*vg.time.adjust,this.checkAngle+=Game.ground.rollingSpeed*vg.time.adjust,this.checkAngle>Game.minSpawnAngle&&(this.checkAngle=0,7>this.treePool.objectInUse.length+this.rockPool.objectInUse.length&&this.spawnNextObjects());for(var e=0;e<this.rotateGroup.length;e++)this.rotateGroup[e].update();this.score=Math.floor(this.totalAngle*Game.worldRadius*.5),Game.scoreText.html(vg.formatNumber(this.score)+"m"),this.wingsActive&&this.sky.update(),vg.input.pressed("space")&&vg.lb.tag.is(":hidden")&&(this.awaitRestart?(this.awaitRestart=!1,this.restartGame(),vgAds.showAd()):this.awaitContinue&&this.continue())}},this.activateMagnet=function(){this.magnetActive?this.magnetTimer.restart():(this.magnetActive=!0,Game.magnet.fadeIn(),this.magnetTimer=this.timer.setTimeout(function(){i.magnetActive=!1,Game.magnet.fadeOut()},i.magnetTime))},this.activateShield=function(){var e=function(){Game.ball.hideProtector()},t=this.shieldTime-Game.ball.protector.flashingTime;this.shieldActive?Game.ball.protector.isFlashing?(Game.ball.protector.stopFlashing(),this.shieldTimer=this.timer.setTimeout(e,t)):this.shieldTimer.restart():(this.shieldActive=!0,Game.ball.showProtector(),this.shieldTimer=this.timer.setTimeout(e,t))},this.activateWings=function(){this.wingsActive=!0,Game.ball.jumping=!1;var e=vg.camera.posY0+10;this.sky.setup(),new TWEEN.Tween(Game.ball.mesh.position).to({y:Game.ball.floatingY},600).onComplete(function(){Game.ball.floating=!0}).start(),new TWEEN.Tween(vg.camera.position).to({y:e},600).start(),Game.ball.showWings(),this.timer.setTimeout(function(){i.wingsActive=!1,vg.play("wing"),Game.ball.hideWings(),new TWEEN.Tween(vg.camera.position).to({y:vg.camera.posY0},900).start()},i.wingsTime)},this.removeObj=function(e){-1<(e=this.rotateGroup.indexOf(e))&&this.rotateGroup.splice(e,1)},this.gameOver=function(){Game.over=!0,Game.ground.accel=-3e-5,Game.groundSpeedSaved=Game.ground.rollingSpeed,this.magnetActive&&this.magnetTimer.end()},this},vg.time={elapsed:0,now:0,adjust:1,fps:60},vg.resize=function(){vg.renderer.setSize(window.innerWidth,window.innerHeight),vg.camera.aspect=window.innerWidth/window.innerHeight,vg.camera.updateProjectionMatrix(),vg.camera.repos(),vg.halfWidth=window.innerWidth/2,vg.halfHeight=window.innerHeight/2},startLoadingAssets();